---
title: "BiocProject Usage"
author: "Michal Stolarczyk"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Vignette Title}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---
## Introduction
The `BiocProject` package formalizes a way how the metadata are presented within the [Bioconductor](https://www.bioconductor.org/) classes, like [Vector](https://bioconductor.org/packages/release/bioc/html/S4Vectors.html), [GRanges](https://bioconductor.org/packages/release/bioc/html/GenomicRanges.html), [SummarizedExperiment](https://bioconductor.org/packages/release/bioc/html/SummarizedExperiment.html), etc. It uses the generic R package [pepr](http://code.databio.org/pepr/) that provides an interface to the Portable Encapsulated Project (PEP) to enclose the metadata to the original Bioconductor objects. 

See the [pepkit.github.io](https://pepkit.github.io/) website to learn more about the PEP environment.

## Usage
In order to use the `BiocProject` package you need two things:

1. a PEP (see [this website](https://pepkit.github.io/docs/simple_example/) for creation instructions and/or use the example provided with this package as guideline)

2. a function that processes your data and returns and object of class that inherits from the Bioconductor class
`Annotated`

To check if a certain object can be used with `BiocProject` run:
```{r, collapse=TRUE,message=FALSE}
library(S4Vectors)
className = "Vector"
any(extends(className)=="Annotated")
```
The workhorse of the `BiocProject` package is the `readBiocData()` function. It creates the `Project` object and uses the user-supplied data processing function to create an object enriched with the metadata from PEP.

**This is how to use it:**

```{r, collapse=TRUE}
library(BiocProject)
# get the example project config provided with the package
ProjectConfig = system.file(
  "extdata",
  "example_peps-master",
  "example_BiocProject",
  "project_config.yaml",
  package = "BiocProject"
)
# get the example data processing function
processFunction =  system.file(
  "extdata",
  "example_peps-master",
  "example_BiocProject",
  "parseEncodeRegions.R",
  package = "BiocProject"
)
# read it into the R enviornment
source(processFunction)
```

And now there are a few possibilities:

- you can specify the function name in the PEP config file in the key value pair presented below and set the `func` parameter of the `readBiocData()` function to `TRUE`

```
bioconductor:
  parse_code: parseEncodeRegions
```

- you can set the `func` parameter of the `readBiocData()` function to the function name (character)

- or you can set the `func` parameter of the `readBiocData()` function to `FALSE` to get jus the `Project` object

```{r, collapse=TRUE}
rbd = readBiocData(file = ProjectConfig, func = TRUE)
rbd
```

The function that was used to process the data [`parseEncodeRegions.R`](https://raw.githubusercontent.com/pepkit/example_peps/master/example_BiocProject/parseEncodeRegions.R) (click to view it) was specified in the [PEP config file](https://raw.githubusercontent.com/pepkit/example_peps/master/example_BiocProject/project_config.yaml).

In the example below the function name was provided as a `func` argument:

```{r, collapse=TRUE}
rbd1 = readBiocData(file = ProjectConfig, func = "parseEncodeRegions")
rbd1
```

As you can see the output of the `readBiocData` function is a `GRanges` object in both cases. However, it is enriched with a `PEP` as a `pepr::Project` object in the metadata slot.

