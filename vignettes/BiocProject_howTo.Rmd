---
title: "BiocProject: Project - SummarizedExperiment interface"
author: "Michal Stolarczyk"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Vignette Title}
  %\VignetteEncoding{UTF-8}
  %\VignetteEngine{knitr::rmarkdown}
editor_options: 
  chunk_output_type: console
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

### Introduction

The `BiocProject` package implements a class that provides an interface for the `Project` and [`SummarizedExperiment`](https://bioconductor.org/packages/release/bioc/html/SummarizedExperiment.html) classes. This way the users of `SummarizedExperiment` can benefit from the utilties and ideology of the [PEP](https://pepkit.github.io/) toolkit. Such as: 

* description of all projects the same way, so you only have to learn one metadata structure,
* collaborative work, since the organization is standardized,
* sharing the project with others, who are already familiar with the standard,
* employment of a variety of tools or pipelines without restructuring the metadata,
* analyis attributes of the project in the data analysis environment of one's choice (R/python).

### How to create the interface?

Load the package
```{r echo=T,message=FALSE,warning=FALSE}
library(BiocProject)
```
Let's create an empty `BiocProject` and see how it looks like
```{r}
bp = BiocProject()
bp
slotNames(bp)
```
As you can see, `bp` the object of class `BiocProject` consists of the slots of the `SummarizedExperiment` objects (such as `assays`, `colData` etc.) and of class `Project` (such as `samples`, `config` etc.) that are an in-memory representation of a PEP.

Obviously, an empty object of `BiocProject` class is useless, so let's consider the following example:

1. Generate the data for `SummarizedExperiment` and `Project`
gitcgit 
```{r}
nrows = 200
ncols = 6
counts = matrix(runif(nrows * ncols, 1, 1e4), nrows)
rowRanges = GRanges(rep(c("chr1", "chr2"), c(50, 150)),
                    IRanges(floor(runif(200, 1e5, 1e6)), width=100),
                    strand=sample(c("+", "-"), 200, TRUE),
                    feature_id=sprintf("ID%03d", 1:200))
colData = DataFrame(Treatment=rep(c("ChIP", "Input"), 3),
                    row.names=LETTERS[1:6])

projectConfig = system.file(
"extdata",
"example_peps-master",
"example_implied",
"project_config.yaml",
package = "pepr"
)

```

3. Create the `BiocProject` object and inspect it

```{r}
bp = BiocProject(file=projectConfig, assays=list(counts=counts), rowRanges=rowRanges, colData=colData)
bp
```

### How to integrate the `SummarizedExperiment` and `Project`?

Currently, there are 2 new methods that can integrate the data from `Project` object with the `SummarizedExperiment` within the `BiocProject` objects: 
<dl>
  <dt>`getColData()`</dt>
  <dd>It copies the data about samples from `samples` slot (previously associated with the `Project` class) of `BiocProject` class to the `colData` slot (previously associated with the `SummarizedExperiment` class).</dd>

  <dt>`getMetadata()`</dt>
  <dd>It enriches the current `metadata` section of `SummarizedExperiment` with the [config file](https://pepkit.github.io/docs/project_config/) content that was used to create the `Project` obejct (PEP).</dd>
  
  <dt>All inherited methods</dt>
  <dd>Please note, that the "getters and setters" methods associated with the `SummarizedExperiment` class (`rowRanges()`, `rowData()`, `colData()` etc.) as well as ones associated with the `Project` class (`samples()`, `config()` etc.) any all the methods that these classes inherit () are also inherited and work with the `BiocProject` class objects.</dd>
</dl>

To see the above-mentioned methods in use, see the section below:

The current (generated) `colData`:

```{r}
colData(bp)
```

Copying the colData with the `BiocProject` methods:

```{r}
bpModified = getColData(bp)
colData(bpModified)
```


The current (generated) `metadata`:

```{r}
metadata(bp)
```

Enriched `metadata`:

```{r}
bpModified = getMetadata(bp)
metadata(bpModified)
```

Now the `metadata` is a list that always consists of two elements `SummarizedExperiment metadata` that consists of the metadata associated with the `SummarizedExperiment` (in a MIAME format) and `PEP config file` that consists of the content of the YAML config file used to create the PEP.

The complete list of all available methods can be accessed by calling `methods` function

```{r}
methods(class = "BiocProject")
```


